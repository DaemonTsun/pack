# pack
C++ & CMake file packaging library.

### What
Simple library for packaging files together and loading them in a C++ program.
Files may be packaged into a single `.pack` file, or loaded from individual files.

Pack generates header files as CMake targets which contain all the information about packages, including all file paths in a static array and file names as preprocessor macros (so that code may use these instead of file paths) as indices into the array.

### Why
Files are a pain. Using these preprocessor macros causes compilation to fail if a filename or path has changed, so that you don't have to keep track of all file references in code yourself.

### How (C++)
In C++, use [`pack_writer`](src/pack/pack_writer.hpp) to add files or data to a package, then write it with `write`.

```cpp
#include "pack/pack_writer.hpp"

void some_function()
{
    pack_writer writer{};
    init(&writer);
    pack_writer_add_file(&writer, "path_to_file.txt");
    pack_writer_write_to_file(&writer, "path_to_output_package.pack");
    free(&writer);
}
```

Then use [`pack_reader`](src/pack/pack_reader.hpp) to read the contents of a package.

```cpp
#include "pack/pack_reader.hpp"

void some_function()
{
    pack_reader reader{};
    init(&reader);
    pack_reader_load_from_path(&reader, "path_to_package.pack");
    
    package_reader_entry entry{};

    for (s64 i = 0; i < reader.toc->entry_count; ++i)
    {
        pack_reader_get_entry(&reader, i, &entry);
        printf("%p, %08x: %s\n", entry.content, entry.size, entry.name);
    }
    
    free(&reader);
}
```

See [pack_tests.cpp](/tests/pack_tests.cpp) for more examples or [this demo](/demo/src/main.cpp) for a full program example.

### How (CMake)
Include the package `pack` in CMake and use the `pack` function to add files for packaging or copying.

```cmake
project(myproject)

find_package(pack REQUIRED)

pack(PACK_OUTPUT_FILES
     BASE "...some base directory..."
     COPY_FILE_DESTINATION "${CMAKE_BINARY_DIR}"
     GEN_HEADER "${CMAKE_SOURCE_DIR}/src/gen/pack_header.h"
     PACKAGE "${CMAKE_BINARY_DIR}/testpack.pack"
     FILES ...files to pack...)

target_sources(myproject ${PACK_OUTPUT_FILES})
```

If the CMake configuration is Release, `pack` will add a target to package the files into the given package path, otherwise `pack` will add targets for copying the files to the `COPY_FILE_DESTINATION` path.
This is done to speed up the debugging process by just copying changed files instead of generating new packages each time.

The files can then be loaded in C++ with [`pack_loader`](src/pack/pack_loader.hpp).

```cpp
#include "pack/pack_loader.hpp"
#include "gen/pack_header.h" // this is generated by CMake pack

void some_function()
{
    package_loader loader{};
    init(&loader);
    load_package(&loader, testpack_pack); // testpack_pack defined in pack_header.h

#ifndef NDEBUG
    pack_loader_load_files(&loader, testpack_pack_files, testpack_pack_file_count);
#else
    pack_loader_load_package_file(&loader, testpack_pack));
#endif
    
    pack_entry entry{};
    
    // entry numbers are defined in gen/pack_header.h.
    pack_loader_load_entry(&loader, <entry number>, &entry);

    // use entry... -> entry.data, entry.size
    
    free(&loader);
}
```

For a fully working example, refer to the [`demo`](/demo) directory.

### Install (optional)

Install the C++ library, headers and CMake package:

```sh
$ mkdir bin
$ cd bin
$ cmake ..
$ make
$ sudo make install
```
