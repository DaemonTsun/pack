# pack
C++ & CMake packaging library

### What
Simple library for packaging files together and loading them in a C++ program.

### Why
Files are a pain.

### How (C++)
In C++, use `pack/package_writer.hpp` to add files or data to a package, then write it with `write`.

```cpp
#include <pack/package_writer.hpp>

void some_function()
{
    package_writer writer;
    add_file(&writer, "path_to_file.txt");
    write(&writer, "path_to_output_package.pack");
    free(&writer);
}
```

Then use `pack/package_reader.hpp` to read the contents of a package.

```cpp
#include <pack/package_reader.hpp>

void some_function()
{
    package_reader reader;
    read(&reader, "path_to_package.pack");
    
    package_reader_entry entry;
    for (int i = 0; i < reader.toc->entry_count; ++i)
    {
        get_package_entry(&reader, i, &entry);
        
        printf("%p, %08x: %s\n", entry.content, entry.size, entry.name);
    }
    
    free(&reader);
}
```

See [pack_tests.cpp](/tests/pack_tests.cpp) for more examples.

### How (CMake)
Packaging in C++ is fine and useful, but we want to automate the process.
Include the package `pack` in CMake and use the `pack` function to add files for packaging or copying.

```cmake
project(myproject)

find_package(pack REQUIRED)

pack(PACK_OUTPUT_FILES
     BASE "...some base directory..."
     COPY_FILE_DESTINATION "${CMAKE_BINARY_DIR}"
     GEN_HEADER "${CMAKE_SOURCE_DIR}/src/pack_header.h"
     PACKAGE "${CMAKE_BINARY_DIR}/testpack.pack"
     FILES ...files to pack...)

target_sources(myproject ${PACK_OUTPUT_FILES})
```

If the CMake configuration is Release, `pack` will add a target to package the files into the given package path, otherwise `pack` will add targets for copying the files to the `COPY_FILE_DESTINATION` path.
This is done to speed up the debugging process by just copying changed files instead of generating new packages each time.

The files can then be loaded in C++ with `pack/package_loader.hpp`.

```cpp
#include <pack/package_loader.hpp>
#include "pack_header.h" // this is generated by CMake pack

void some_function()
{
    package_loader loader;
    load_package(&loader, testpack_pack); // testpack_pack defined in pack_header.h
    
    // load_package will either load the package if it is a package, or store the paths to
    // files if the files were just copied and not packaged.
    // You can explicitly load a package with load_package_file(loader, <path>)
    // or explicitly load files with load_files(loader, file_path_array, file_path_array_size);
    
    memory_stream stream;
    init(&stream);
    
    // entry numbers are defined in pack_header.h.
    load_entry(&loader, <entry number>, &stream);
    
    // if package is a package, stream will only point to the memory of the loaded package
    // (no copy is performed).
    // otherwise, loads the file the entry number is pointing to and saves its contents into
    // stream.
    
    free(&loader);
}
```

For a fully working example, refer to the [demo](/demo) directory.

### Installation

Install the C++ library, headers and CMake package:

```sh
$ mkdir bin
$ cd bin
$ cmake ..
$ make
$ sudo make install
```
